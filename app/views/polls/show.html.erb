<!-- Alertas/Notificações -->
<% if notice %>
  <div class="bg-green-50 border-l-4 border-green-500 p-4 mb-6 rounded">
    <div class="flex">
      <div class="flex-shrink-0">
        <i class="fas fa-check-circle text-green-400"></i>
      </div>
      <div class="ml-3">
        <p class="text-sm text-green-700"><%= notice %></p>
      </div>
    </div>
  </div>
<% end %>

<% if alert %>
    <div class="bg-red-50 border-l-4 border-red-500 p-4 mb-6 rounded">
      <div class="flex">
        <div class="flex-shrink-0">
          <i class="fas fa-exclamation-circle text-red-400"></i>
        </div>
        <div class="ml-3">
          <p class="text-sm text-red-700"><%= alert %></p>
        </div>
      </div>
    </div>
  <% end %>

<div class="grid grid-cols-3 md:grid-cols-3 gap-3 p-6">
  
  <!-- Card da Enquete -->
  <div class="rounded-xl overflow-hidden mb-6">
    <div class="bg-gradient-to-r from-orange-500 to-amber-300 h-2"></div>
    <%= render @poll %>
  </div>

  <!-- Seção de Votação -->
  <% if @poll.status == 'open' && !admin_signed_in? %>
    <div class="bg-white rounded-xl shadow-md overflow-hidden border border-gray-100 mb-6">
      <div class="bg-gradient-to-r from-green-500 to-emerald-600 h-2"></div>
      <div class="p-6">
        <h2 class="text-xl font-semibold text-gray-900 mb-4">Faça sua votação</h2>
        
        <% if user_signed_in? %>
          <% if current_user.id != @poll.user_id %>
            <% if @poll.votes.where(user: current_user).empty? %>
              <%= form_with url: poll_votes_path(@poll), method: :post, class: "space-y-4" do |f| %>
                <input type="hidden" name="poll_id" value="<%= @poll.id %>">
                
                <div class="space-y-3">
                  <% @poll.options.each do |option| %>
                    <div class="flex items-start">
                      <% if @poll.poll_type == 'single_choice' %>
                        <%= radio_button_tag "option_id", option.id, false, 
                          class: "mt-1 mr-3 text-blue-600 focus:ring-blue-500 border-gray-300 rounded",
                          required: true %>
                      <% else %>
                        <%= check_box_tag "option_ids[]", option.id, false, 
                            class: "mt-1 mr-3 text-blue-600 focus:ring-blue-500 border-gray-300 rounded" %>
                      <% end %>
                      
                      <label for="<%= @poll.poll_type == 'single_choice' ? "option_id_#{option.id}" : "option_ids_#{option.id}" %>" 
                            class="block text-gray-700 cursor-pointer hover:bg-gray-50 p-2 rounded-lg flex-1">
                        <%= option.text %>
                      </label>
                    </div>
                  <% end %>
                </div>

                <div class="pt-4">
                  <%= button_tag type: "submit", 
                      class: "bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-6 rounded-lg transition duration-200 cursor-pointer" do %>
                    <i class="fas fa-vote-yea mr-2"></i> Registrar Voto
                  <% end %>
                </div>
              <% end %>
            <% else %>
              <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded">
                <div class="flex">
                  <div class="flex-shrink-0">
                    <i class="fas fa-exclamation-triangle text-yellow-400"></i>
                  </div>
                  <div class="ml-3">
                    <p class="text-sm text-yellow-700">
                      Você já votou nessa enquete!
                    </p>
                  </div>
                </div>
              </div>
            <% end %>
          <% else %>
            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded">
              <div class="flex">
                <div class="flex-shrink-0">
                  <i class="fas fa-exclamation-triangle text-yellow-400"></i>
                </div>
                <div class="ml-3">
                  <p class="text-sm text-yellow-700">
                    Você não pode votar na sua própria enquete.
                  </p>
                </div>
              </div>
            </div>
          <% end %>
        <% else %>
          <div class="bg-blue-50 border-l-4 border-blue-400 p-4 rounded">
            <div class="flex">
              <div class="flex-shrink-0">
                <i class="fas fa-info-circle text-blue-400"></i>
              </div>
              <div class="ml-3">
                <p class="text-sm text-blue-700">
                  Você precisa fazer login como um Usuário, para votar nesta enquete.
                </p>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>

  <!-- Seção de Resultados -->
  <div class="bg-white rounded-xl shadow-md overflow-hidden border border-gray-100 mb-6">
    <div class="bg-gradient-to-r from-purple-500 to-indigo-600 h-2"></div>
    <div class="p-6">
      <h2 class="text-xl font-semibold text-gray-900 mb-4">
        <% if @poll.status == 'closed' %>
          Resultados Finais
        <% else %>
          Resultados Parciais
        <% end %>
      </h2>

      <div class="space-y-4">
        <% @poll.options.each do |option| %>
          <% vote_count = option.votes.count %>
          <% total_votes = @poll.votes.count %>
          <% percentage = total_votes > 0 ? (vote_count.to_f / total_votes * 100).round(1) : 0 %>
          
          <div>
            <div class="flex justify-between items-center mb-1">
              <span class="text-sm font-medium text-gray-700"><%= option.text %></span>
              <span class="text-sm text-gray-500"><%= vote_count %> votos (<%= percentage %>%)</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-2">
              <div class="bg-blue-600 h-2 rounded-full" style="width: <%= percentage %>%"></div>
            </div>
          </div>
        <% end %>
      </div>

      <div class="mt-4 pt-4 border-t border-gray-200">
        <p class="text-sm text-gray-500">Total de votos: <span class="font-medium"><%= @poll.votes.count %></span></p>
      </div>
    </div>
  </div>

  <!-- Ações -->
  <div class="bg-white rounded-xl shadow-md p-6 ">
    <div class="flex flex-col sm:flex-row gap-4 justify-between items-center">
      <div class="flex flex-col sm:flex-row gap-3">

        
        <%# if current_user.id == @poll.user_id && @poll.status == 'open' %>
          <%#= link_to edit_poll_path(@poll), class: "flex items-center justify-center px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white font-medium rounded-lg transition-colors duration-300" do %>
          <!--  <i class="fas fa-edit mr-2"></i> Editar Enquete -->
          <%# end %>
        <%# end %>
        
        <%= link_to polls_path, class: "flex items-center justify-center px-4 py-2 border border-gray-300 hover:bg-gray-50 text-gray-700 font-medium rounded-lg transition-colors duration-300" do %>
          <i class="fas fa-arrow-left mr-2"></i> Voltar para Enquetes
        <% end %>
      </div>
      


      <%# if current_user.id == @poll.user_id%>
        <%#= button_to @poll, method: :delete, 
            data: { turbo_confirm: "Tem certeza que deseja excluir esta enquete?" }, 
            class: "flex items-center justify-center px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg transition-colors duration-300 cursor-pointer" do %>
          <!--  <i class="fas fa-trash mr-2"></i> Excluir Enquete -->
        <%# end %>
      <%# end %>

      <% if current_user.id == @poll.user_id && @poll.status == 'open' %>

        <%= button_to close_poll_path(@poll), 
            method: :patch, 
            class: "px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg transition-colors duration-300 cursor-pointer" do %>
          <i class="fas fa-lock mr-2"></i> Fechar Enquete
        <% end %>

      <% end %>

    </div>
  </div>
</div>